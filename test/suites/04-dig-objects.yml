# Venom Test Suite definition
# Check Venom documentation for more information : https://github.com/ovh/venom
name: compute metrics on values stored in deep structures
testcases:
  - name: deep objects
    steps:
      - script: echo '{"person":{"age":24,"adress":{"street":"Baroque Street"}}}' > working/real.jsonl
      - script: echo '{"person":{"age":43,"adress":{"street":"Baroque Street"}}}' >> working/real.jsonl

      - script: echo '{"person":{"age":34,"adress":{"street":"Classic Street"}}}' > working/masked.jsonl
      - script: echo '{"person":{"age":83,"adress":{"street":"Expression Avenue"}}}' >> working/masked.jsonl

      - script: cat working/masked.jsonl | mimo -v3 working/real.jsonl
        assertions:
          - result.code ShouldEqual 0
          - result.systemerr ShouldContainSubstring value count-empty=0 count-masked=8 count-missed=2 count-nil=1 field=value rate-coherence=0.6666666666666666 rate-identifiable=0.6 rate-masking=0.8

      - script: mv report.html ../reports/report_deep_object.html
